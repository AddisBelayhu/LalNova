{"ast":null,"code":"import _objectSpread from\"E:/LalNova/Full_Stack Development/LalNova Technologies/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{BarChart3,Users,Briefcase,MessageSquare,Plus,Edit,Trash2,Eye,X}from'lucide-react';import axios from'axios';import toast from'react-hot-toast';import{getCategories,getCategoryName}from'../utils/categories';import ReactQuill from'react-quill';import'react-quill/dist/quill.snow.css';import'../styles/richtext.css';import{getPreviewText}from'../utils/htmlUtils';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const AdminDashboard=()=>{const[activeTab,setActiveTab]=useState('overview');const[services,setServices]=useState([]);const[projects,setProjects]=useState([]);const[messages,setMessages]=useState([]);const[showModal,setShowModal]=useState(false);const[modalType,setModalType]=useState('');const[editingItem,setEditingItem]=useState(null);// Initialize categories from shared utility\nconst[categories,setCategories]=useState(()=>getCategories());const[formData,setFormData]=useState({});// Rich text editor configuration\nconst quillModules={toolbar:[[{'header':[1,2,3,false]}],['bold','italic','underline','strike'],[{'list':'ordered'},{'list':'bullet'}],[{'indent':'-1'},{'indent':'+1'}],['link'],[{'align':[]}],[{'color':[]},{'background':[]}],['clean']]};const quillFormats=['header','bold','italic','underline','strike','list','bullet','indent','link','align','color','background'];// Save categories to localStorage whenever categories change\nuseEffect(()=>{localStorage.setItem('adminCategories',JSON.stringify(categories));},[categories]);// Category management functions\nconst handleAddCategory=()=>{const id=prompt('Enter category ID (e.g., MOBILE_DEV):');const name=prompt('Enter category display name (e.g., Mobile Development):');if(id&&name){const newCategory={id:id.toUpperCase(),name};setCategories([...categories,newCategory]);toast.success('Category added successfully');}};const handleEditCategory=category=>{const newName=prompt('Enter new display name:',category.name);if(newName&&newName!==category.name){setCategories(categories.map(cat=>cat.id===category.id?_objectSpread(_objectSpread({},cat),{},{name:newName}):cat));toast.success('Category updated successfully');}};const handleDeleteCategory=categoryId=>{if(!window.confirm('Are you sure you want to delete this category?'))return;// Check if any services use this category\nconst servicesUsingCategory=services.filter(service=>service.category===categoryId);if(servicesUsingCategory.length>0){toast.error(\"Cannot delete category. \".concat(servicesUsingCategory.length,\" service(s) are using it.\"));return;}setCategories(categories.filter(cat=>cat.id!==categoryId));toast.success('Category deleted successfully');};useEffect(()=>{fetchData();},[]);const fetchData=async()=>{try{const[servicesRes,projectsRes,messagesRes]=await Promise.all([axios.get('/api/admin/services'),axios.get('/api/admin/projects'),axios.get('/api/admin/messages')]);setServices(servicesRes.data);setProjects(projectsRes.data);setMessages(messagesRes.data);}catch(error){toast.error('Failed to fetch data');}};const handleCreate=type=>{setModalType(type);setEditingItem(null);setFormData(getEmptyFormData(type));setShowModal(true);};const handleEdit=(type,item)=>{setModalType(type);setEditingItem(item);setFormData(_objectSpread({},item));// Create a copy to avoid reference issues\nsetShowModal(true);};const handleDelete=async(type,id)=>{if(!window.confirm('Are you sure you want to delete this item?'))return;try{await axios.delete(\"/api/admin/\".concat(type,\"/\").concat(id));toast.success('Item deleted successfully');fetchData();}catch(error){toast.error('Failed to delete item');}};const handleSubmit=async e=>{e.preventDefault();try{// Clean and validate data before submission\nlet submitData=_objectSpread({},formData);if(modalType==='services'){// Ensure all required fields are present and properly formatted\nsubmitData={title:(formData.title||'').trim(),description:(formData.description||'').trim(),icon:(formData.icon||'code').trim(),category:formData.category||'SOFTWARE_DEV'};// Client-side validation to match backend requirements\nif(submitData.title.length<3||submitData.title.length>200){toast.error('Service title must be between 3 and 200 characters');return;}if(submitData.description.length<10||submitData.description.length>1000){toast.error('Service description must be between 10 and 1000 characters');return;}if(!submitData.icon){toast.error('Icon field is required');return;}}else if(modalType==='projects'){// Clean project data\nsubmitData={title:(formData.title||'').trim(),description:(formData.description||'').trim(),technologiesUsed:(formData.technologiesUsed||'').trim(),imageUrl:(formData.imageUrl||'').trim()||undefined,link:(formData.link||'').trim()||undefined};// Remove empty optional fields\nif(!submitData.imageUrl)delete submitData.imageUrl;if(!submitData.link)delete submitData.link;// Client-side validation\nif(submitData.title.length<3||submitData.title.length>200){toast.error('Project title must be between 3 and 200 characters');return;}if(submitData.description.length<10||submitData.description.length>1000){toast.error('Project description must be between 10 and 1000 characters');return;}if(submitData.technologiesUsed.length<1){toast.error('Technologies field is required');return;}}console.log('Submitting data:',submitData);// Debug log\nif(editingItem){const response=await axios.put(\"/api/admin/\".concat(modalType,\"/\").concat(editingItem.id),submitData);console.log('Update response:',response.data);// Debug log\ntoast.success('Item updated successfully');}else{const response=await axios.post(\"/api/admin/\".concat(modalType),submitData);console.log('Create response:',response.data);// Debug log\ntoast.success('Item created successfully');}setShowModal(false);fetchData();}catch(error){var _error$response,_error$response2,_error$response2$data;console.error('Submit error:',((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);// Debug log\n// Show specific validation errors if available\nif((_error$response2=error.response)!==null&&_error$response2!==void 0&&(_error$response2$data=_error$response2.data)!==null&&_error$response2$data!==void 0&&_error$response2$data.details){toast.error(\"Validation Error: \".concat(error.response.data.details.join(', ')));}else{var _error$response3,_error$response3$data;toast.error(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.error)||'Failed to save item');}}};const getEmptyFormData=type=>{switch(type){case'services':return{title:'',description:'',icon:'code',category:'SOFTWARE_DEV'};case'projects':return{title:'',description:'',technologiesUsed:'',imageUrl:'',link:''};default:return{};}};const tabs=[{id:'overview',label:'Overview',icon:BarChart3},{id:'services',label:'Services',icon:Briefcase},{id:'projects',label:'Projects',icon:Users},{id:'categories',label:'Categories',icon:Edit},{id:'messages',label:'Messages',icon:MessageSquare}];return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto section-padding\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-secondary mb-2\",children:\"Admin Dashboard\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Manage your website content and view analytics\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-xl shadow-md mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex border-b\",children:tabs.map(tab=>/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab(tab.id),className:\"flex items-center px-6 py-4 font-medium transition-colors \".concat(activeTab===tab.id?'text-primary border-b-2 border-primary':'text-gray-600 hover:text-primary'),children:[/*#__PURE__*/_jsx(tab.icon,{className:\"mr-2\",size:20}),tab.label]},tab.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[activeTab==='overview'&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-50 rounded-xl p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-blue-600 font-medium\",children:\"Total Services\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-blue-800\",children:services.length})]}),/*#__PURE__*/_jsx(Briefcase,{className:\"text-blue-600\",size:32})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-50 rounded-xl p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-green-600 font-medium\",children:\"Total Projects\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-green-800\",children:projects.length})]}),/*#__PURE__*/_jsx(Users,{className:\"text-green-600\",size:32})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-purple-50 rounded-xl p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-purple-600 font-medium\",children:\"New Messages\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-purple-800\",children:messages.length})]}),/*#__PURE__*/_jsx(MessageSquare,{className:\"text-purple-600\",size:32})]})})]}),activeTab==='services'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-secondary\",children:\"Manage Services\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleCreate('services'),className:\"btn-primary flex items-center\",children:[/*#__PURE__*/_jsx(Plus,{className:\"mr-2\",size:20}),\"Add Service\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:services.map(service=>{var _categories$find;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 rounded-xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-secondary\",children:service.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleEdit('services',service),className:\"text-blue-600 hover:text-blue-800\",children:/*#__PURE__*/_jsx(Edit,{size:16})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete('services',service.id),className:\"text-red-600 hover:text-red-800\",children:/*#__PURE__*/_jsx(Trash2,{size:16})})]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm mb-2\",children:getPreviewText(service.description,100)}),/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded\",children:((_categories$find=categories.find(cat=>cat.id===service.category))===null||_categories$find===void 0?void 0:_categories$find.name)||service.category})]},service.id);})})]}),activeTab==='projects'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-secondary\",children:\"Manage Projects\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleCreate('projects'),className:\"btn-primary flex items-center\",children:[/*#__PURE__*/_jsx(Plus,{className:\"mr-2\",size:20}),\"Add Project\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:projects.map(project=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 rounded-xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-secondary\",children:project.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleEdit('projects',project),className:\"text-blue-600 hover:text-blue-800\",children:/*#__PURE__*/_jsx(Edit,{size:16})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete('projects',project.id),className:\"text-red-600 hover:text-red-800\",children:/*#__PURE__*/_jsx(Trash2,{size:16})})]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm mb-2\",children:project.description}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-1\",children:project.technologiesUsed.split(', ').slice(0,3).map((tech,index)=>/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 bg-green-100 text-green-800 text-xs rounded\",children:tech},index))})]},project.id))})]}),activeTab==='categories'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-secondary\",children:\"Manage Categories\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleAddCategory,className:\"btn-primary flex items-center\",children:[/*#__PURE__*/_jsx(Plus,{className:\"mr-2\",size:20}),\"Add Category\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:categories.map(category=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 rounded-xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-secondary\",children:category.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"ID: \",category.id]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleEditCategory(category),className:\"text-blue-600 hover:text-blue-800\",children:/*#__PURE__*/_jsx(Edit,{size:16})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteCategory(category.id),className:\"text-red-600 hover:text-red-800\",children:/*#__PURE__*/_jsx(Trash2,{size:16})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"Used by \",services.filter(s=>s.category===category.id).length,\" service(s)\"]})]},category.id))})]}),activeTab==='messages'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between items-center mb-6\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-secondary\",children:\"Contact Messages\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:messages.map(message=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 rounded-xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-secondary\",children:message.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:message.email}),message.phone&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:message.phone})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex space-x-2\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete('messages',message.id),className:\"text-red-600 hover:text-red-800\",children:/*#__PURE__*/_jsx(Trash2,{size:16})})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700\",children:message.message}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-2\",children:new Date(message.createdAt).toLocaleDateString()})]},message.id))})]})]})]})]}),showModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-xl p-6 w-full max-w-md mx-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold text-secondary\",children:[editingItem?'Edit':'Add',\" \",modalType.slice(0,-1)]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowModal(false),className:\"text-gray-500 hover:text-gray-700\",children:/*#__PURE__*/_jsx(X,{size:24})})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[modalType==='services'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Service Title\",value:formData.title||'',onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{title:e.target.value})),className:\"w-full px-4 py-2 border rounded-lg\",required:true}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Service Description\"}),/*#__PURE__*/_jsx(ReactQuill,{theme:\"snow\",value:formData.description||'',onChange:content=>setFormData(_objectSpread(_objectSpread({},formData),{},{description:content})),modules:quillModules,formats:quillFormats,placeholder:\"Enter service description with rich formatting...\",style:{height:'200px',marginBottom:'50px'}})]}),/*#__PURE__*/_jsx(\"select\",{value:formData.category||'SOFTWARE_DEV',onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{category:e.target.value})),className:\"w-full px-4 py-2 border rounded-lg\",required:true,children:categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category.id,children:category.name},category.id))})]}),modalType==='projects'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Project Title\",value:formData.title||'',onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{title:e.target.value})),className:\"w-full px-4 py-2 border rounded-lg\",required:true}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Project Description\",value:formData.description||'',onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{description:e.target.value})),className:\"w-full px-4 py-2 border rounded-lg\",rows:3,required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Technologies (comma-separated)\",value:formData.technologiesUsed||'',onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{technologiesUsed:e.target.value})),className:\"w-full px-4 py-2 border rounded-lg\"}),/*#__PURE__*/_jsx(\"input\",{type:\"url\",placeholder:\"Image URL\",value:formData.imageUrl||'',onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{imageUrl:e.target.value})),className:\"w-full px-4 py-2 border rounded-lg\"}),/*#__PURE__*/_jsx(\"input\",{type:\"url\",placeholder:\"Project Link\",value:formData.link||'',onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{link:e.target.value})),className:\"w-full px-4 py-2 border rounded-lg\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn-primary flex-1\",children:editingItem?'Update':'Create'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowModal(false),className:\"btn-secondary flex-1\",children:\"Cancel\"})]})]})]})})]});};export default AdminDashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}